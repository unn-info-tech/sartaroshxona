{% extends 'main/base.html' %}
{% load static %}
{% load custom_filters %}


{% block content %}
{% include 'main/navbar.html' %}


<link rel="stylesheet" href="{% static 'css/clients.css' %}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
<script src="{% static 'js/clients.js' %}"></script>

<meta name="viewport" content="width=device-width, initial-scale=1.0">


<div class="container">

    <div class="header" id="header" style="display: none;">
        <div class="category" id="inQueueCategory">
            <a href="{% url 'appointments_by_category' 'in_queue' %}">
                <h2><i class="fas fa-users"></i></h2>
                <p class="count">{{ appointment_in_queue_count }}</p>
            </a>
        </div>
    
        <div class="category" id="confirmedCategory">
            <a href="{% url 'appointments_by_category' 'confirmed' %}">
                <h2><i class="material-icons">how_to_reg</i></h2>
                <p class="count">{{ appointment_confirmed_count }}</p>
            </a>
        </div>
    
        <div class="category" id="historyCategory">
            <a href="{% url 'appointments_by_category' 'done' %}">
                <h2><i class="fas fa-history"></i></h2>
                <p class="count">{{ interactions_count }}</p>
            </a>
        </div>

        <div class="category" id="moneyCategory">
            <a href="{% url 'appointments_by_category' 'money' %}">
                <h2><i class="fas fa-money-bill-wave"></i></h2>

                <p class="count">{{ daily_work_records_count }}</p>
            </a>
        </div>


    </div>

    <button onclick="toggleHeader()" id="toggleButton">
        <i id="icon" class="fas fa-chevron-down"></i>
    </button>
    
    
    


    <!-- Content from the second HTML -->
    <div class="list-content">
        <h1>{{ category }}</h1>
        <table>
            <thead>
                <tr>
                    {% if category == 'in_queue' or category == 'confirmed' %}
                        <th>Customer Name</th>
                        <th>Appointment Date and Time</th>
                        <th>Service</th>
                        <th>Action</th>
                    {% elif category == 'done' %}
                        <th>Customer Name</th>
                        <th>Times Appointed</th>
                    {% elif category == 'money' %}
                        <th>Date</th>
                        <th>Amount worked</th>
                    
                    {% endif %}
                    
                </tr>
            </thead>
            <tbody>
<!----------------- This is for 'in_queue' or 'confirmed'------------------------------------>
                {% if category == 'in_queue' or category == 'confirmed' %}
                    {% for appointment in appointments %}
                        <tr>
                            <td>{{ appointment.client.username }}</td>
                            <td>{{ appointment.appointment_time }}</td>
                            <td>
                                {% for service in appointment.service.all %}
                                    <li>{{ service.title }} - {{ service.duration_minutes}} min.<i class="fas fa-clock fa-inverse"></i> {{ service.price }}{{ service.currency }} <i class="fas fa-money-bill-wave"></i></li>
                                {% empty %}
                                    <li>No services selected for this appointment.</li>
                                {% endfor %}

                                {% if appointment.service.all %}
                                <p>
                                    <span>= <i class="fas fa-money-bill-wave"></i></li> {{ appointment.service.all|sum_attribute:'price' }}</span>
                                    <span><i class="fas fa-clock fa-inverse"></i> {{ appointment.service.all|sum_attribute:'duration_minutes' }} minutes</span>
                                </p>
                                {% endif %}
                                
                            </td>
                            <!-- This is for accept or cancel-->
                            <td>
                                {% if category == 'in_queue' %}
                                    <form action="{% url 'accept_and_done_appointment' appointment.id %}" method="post">
                                        {% csrf_token %}
                                        <button name="accept" class="btn btn-outline-primary btn-duration" type="submit">Accept</button>
                                    </form>
                                    <div style="margin-top: 10px;"></div> <!-- Adjust margin-top as needed -->
                                    <form action="{% url 'cancel_appointment' appointment.id category %}" method="post">
                                        {% csrf_token %}
                                        <button class="btn btn-outline-primary btn-duration" type="submit">Cancel</button>
                                    </form>
                                {% elif category == 'confirmed' %}
                                    <form action="{% url 'accept_and_done_appointment' appointment.id %}" method="post">
                                        {% csrf_token %}
                                        <button name="done" class="btn btn-outline-primary btn-duration" type="submit">Service is done</button>
                                    </form>
                                    <div style="margin-top: 10px;"></div> <!-- Adjust margin-top as needed -->
                                    <form action="{% url 'cancel_appointment' appointment.id category%}" method="post">
                                        {% csrf_token %}
                                        <button class="btn btn-outline-primary btn-duration" type="submit">Service is undone</button>
                                    </form>
                                {% endif %}

                            </td>
                        </tr>
                    {% empty %}
                        <tr>
                            <td colspan="3">No appointments found for this barber.</td>
                        </tr>
                    {% endfor %} 
<!----------------- This is for 'done'------------------------------------>
                {% elif category == 'done' %}
                    {% for interaction in interactions %}
                        <tr>
                            <td>{{ interaction.client }}</td>
                            <td>{{ interaction.times_appointed }}</td>
                        </tr>
                    {% empty %}
                        <tr>
                            <td colspan="2">No clients found for this barber.</td>
                        </tr>
                    {% endfor %} 
<!----------------- This is for 'money'------------------------------------>
                {% elif category == 'money' %}
                    {% for daily_work_record in daily_work_records %}
                        <tr>
                            <td>{{ daily_work_record.date }}</td>
                            <td>{{ daily_work_record.amount_worked }}{{ currency }}</td>
                        </tr>
                    {% empty %}
                        <tr>
                            <td colspan="2">No amount_worked found for this barber.</td>
                        </tr>
                    {% endfor %} 

                {% endif  %} 

            </tbody>
        </table>
    </div>

</div>
  
  
{% endblock %}